<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Moja pozycja + kierunek + kamera</title>
  <style>
    body { font-family: sans-serif; }
    video {
      width: 100%;
      max-width: 400px;
      background: black;
      border: 2px solid #333;
      border-radius: 8px;
      display: block;
      margin: 10px 0;
    }
    pre {
      background: #eee;
      padding: 10px;
      border-radius: 6px;
      display: inline-block;
    }
  </style>
</head>
<body>

  <pre id="pos">Pobieranie danych...</pre>
  
  <video id="camera" autoplay playsinline></video>

  <button id="vibrateButton">Zawibruj telefon</button>

  <script>
    const el = document.getElementById('pos');
    const video = document.getElementById('camera');

    let lat, lon, acc, heading, beta, gamma;

    function pokaz() {
      el.textContent =
        (lat ? `Lat: ${lat}\nLon: ${lon}\nDokładność: ${Math.round(acc)} m\n` : '') +
        (heading != null ? `Kierunek (alpha): ${Math.round(heading)}°\n` : '') +
        (beta != null ? `Kąt (beta): ${Math.round(beta)}°\n` : '') +
        (gamma != null ? `Kąt (gamma): ${Math.round(gamma)}°\n` : '');
    }


    if ("geolocation" in navigator) {
      navigator.geolocation.watchPosition(
        pos => {
          lat = pos.coords.latitude.toFixed(6);
          lon = pos.coords.longitude.toFixed(6);
          acc = pos.coords.accuracy;
          pokaz();
        },
        err => el.textContent = "Błąd GPS: " + err.message,
        { enableHighAccuracy: true }
      );
    } else {
      el.textContent = "Brak wsparcia geolokalizacji.";
    }

    if ("DeviceOrientationEvent" in window) {
      window.addEventListener("deviceorientation", e => {
        if (e.alpha != null) heading = 360 - e.alpha;
        if (e.beta  != null) beta = e.beta;
        if (e.gamma != null) gamma = e.gamma;
        pokaz();
      });
    } else {
      el.textContent += "\nBrak wsparcia orientacji.";
    }

    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "user" },
          audio: false
        });
        video.srcObject = stream;
      } catch (err) {
        el.textContent += `\nBłąd kamery: ${err.message}`;
      }
    }

    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      startCamera();
    } else {
      el.textContent += "\nBrak wsparcia kamery.";
    }

    document.getElementById('vibrateButton').addEventListener('click', () => {
      if ("vibrate" in navigator) {
        navigator.vibrate(500);
      } else {
        alert("Brak wsparcia wibracji.");
      }
    });
  </script>

</body>
</html>
